# Contributing

Before getting started, thanks for considering contributing to `terraform-provider-metal` for [metalstack.cloud](https://metalstack.cloud)!
As this plugin is still in its early stages any feedback is valuable and helps us harden the implementation and to improve the docs and api.

**Table of Contents**

- [Code Contributions](#Code_Contributions)
  - [Requirements](#Requirements)
  - [Naming Conventions](#Naming_Conventions)
  - [Layout Conventions](#Layout_Conventions)
  - [Acceptance Tests](#Acceptance_Tests)

## Code Contributions

This project is built on top of the [Terraform Plugin Framework](https://github.com/hashicorp/terraform-plugin-framework).

### Requirements

- [Terraform](https://developer.hashicorp.com/terraform/downloads) >= 1.0
- [Go](https://golang.org/doc/install) >= 1.19
- Access to a [metalstack.cloud](https://metalstack.cloud) or [metal-stack-cloud/deployment](https://github.com/metal-stack-cloud/deployment) to run Acceptance Test
- As our provider has not yet been released, you need to link it inside your `~/.terraformrc/`. Don't forget to adjust the registry path to your clone.

```
provider_installation {
  dev_overrides {
    "metalstack.cloud/terraform/metal" = "/home/you/path-to/metal-stack-cloud/terraform-provider-metal-stack-cloud/"
  }

  direct {}
}
```

Before testing always make sure to rebuild `make build`.

### Naming Conventions

We try to enforce some patterns for every resource or data source in this provider.
Resources should memorizable and must be declared in singular.
For every resource, there should be a Data Source to list all values the resource represents.
If possible a singular named data source can be provided, too.

For example:

- If there is a resource `metal_public_ip`.
- There should be a data source `metal_public_ips` containing `items` with the same fields as a single `metal_public_ip`.
- In the future we might add a `metal_public_ip` data source. It would error if not exactly one resource would be found. For now use the import.

### Layout Conventions

The desired project layout tries to group data sources and resources that logically belong together in one folder.
For every resource and data source, an example must be provided below `examples`. Their implementations live within `internal`. 

```
.
├── docs
│   └── <generated by `$ make gen`>
├── examples
│   ├── README.md
│   ├── data-sources
│   │   └── <name of the data-source>
│   │       └── data-source.tf
│   ├── provider
│   │   └── provider.tf
│   └── resources
│       └── <name of the resource>
│           └── resource.tf
├── go.mod
├── go.sum
├── internal
│   ├── provider
│   │   └── provider.go
│   ├── <resource or singular data source name>
│   │   ├── dataCurrently the code is mostly located in the hcloud package. In the long term we want to move most of the hcloud package into individual sub-packages located in the internal directory. The goal is a structure similar to HashiCorp's Terraform Provider Scaffolding_source.go
│   │   ├── data_source_test.go
│   │   ├── model.go
│   │   ├── resource.go
│   │   └── schema.go
│   └── session
│       └── session.go
├── main.go
├── terraform-registry-manifest.json
└── tools
    └── tools.go
```

### Acceptance Tests

The acceptance tests need to run against a metalstack.cloud api. To avoid running it against your production clusters, override the inferred parameters of the provider.

```bash
export METAL_STACK_CLOUD_API_URL="http://api.172.17.0.1.nip.io:8080" # in case you are using metal-stack-cloud/deployment
export METAL_STACK_CLOUD_API_TOKEN="ey..."
export METAL_STACK_CLOUD_ORGANIZATION="username@github"
export METAL_STACK_CLOUD_PROJECT="<your project uuid>"
```

After you prepared your local environment, run `$ make testacc`.
